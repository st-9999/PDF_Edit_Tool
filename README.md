# PDF Edit Tool

ブラウザ上で動作するPDF編集ツール。すべての処理をクライアントサイドで実行するため、ファイルがサーバーにアップロードされることはありません。

**公開URL**: https://st-9999.github.io/PDF_Edit_Tool/

## 機能

| 機能 | 説明 |
|------|------|
| しおり編集 | ツリー構造のブックマークを作成・編集（既存しおり読み込み対応） |
| しおり自動生成 | PDF本文から見出しを自動検出し、階層しおりを一括生成 |
| ページ並び替え | ドラッグ&ドロップでページ順序を変更 |
| ページ削除 | 選択したページを除外したPDFを生成 |
| ページ回転 | 個別 or 一括で 90°/180°/270° 回転 |
| ページ抽出 | 選択したページだけで新規PDFを生成（範囲指定対応） |
| 複数PDF結合 | 複数ファイルを1つのPDFに結合（ファイル順序変更可） |

## セットアップ

### 前提条件

- Node.js 20 LTS 以上
- npm

### インストール & 起動

```bash
npm install
npm run dev
```

ブラウザで http://localhost:3000 を開いてください。

### 本番ビルド

```bash
npm run build
npm start
```

## テスト

```bash
npm test              # ウォッチモード（vitest）
npm run test:run      # 単発実行
npm run test:coverage # カバレッジ付き実行
npm run test:e2e      # E2Eテスト（Playwright）
npm run test:e2e:ui   # E2Eテスト（UIモード）
```

| 種別 | フレームワーク | テスト数 |
|------|--------------|---------|
| ユニットテスト | Vitest | 138件（11スイート） |
| コンポーネントテスト | Vitest + Testing Library | 47件（4スイート） |
| 統合テスト | Vitest | 8件（1スイート） |
| E2Eテスト | Playwright | 4件 |

## デプロイ

GitHub Actions で `main` ブランチへの push 時に自動デプロイされます。

- ワークフロー: `.github/workflows/deploy.yml`
- ビルド: `next build` → 静的ファイル（`out/`）を生成
- ホスティング: GitHub Pages（`/PDF_Edit_Tool/`）

## 使い方

1. トップページで機能タブ（しおり / 並び替え / 抽出 / 結合）から選択
2. PDFファイルをドラッグ&ドロップ or クリックしてアップロード
3. 各機能に応じた編集を行う
4. 「保存」ボタンで編集済みPDFをダウンロード

### しおり編集

1. 「しおり」タブでPDFをアップロード
2. 「既存のしおりを読み込む」で既存ブックマークを取得（任意）
3. 「親しおりを追加」でしおりを作成
4. タイトルとページ番号を編集
5. インデント / アウトデントで階層構造を構築
6. ページビューアーでテキストを選択すると、しおりタイトルに反映可能

### しおり自動生成

1. しおりエディタ内の「自動生成」ボタンをクリック
2. 見出しパターン（「第1章」「1.1」等）を選択 or カスタム正規表現を指定
3. 開始ページを設定して抽出を実行
4. 検出された見出しがツリー構造で自動生成される

### 結合

1. 「結合」タブで複数のPDFファイルをアップロード
2. ファイルの順序を上下ボタンで調整
3. 「結合したPDFをダウンロード」をクリック

## 技術スタック

| カテゴリ | 技術 |
|---------|------|
| フレームワーク | Next.js 16 (App Router, TypeScript) |
| PDF操作 | pdf-lib (編集) / pdfjs-dist (レンダリング・テキスト抽出) |
| ドラッグ&ドロップ | @dnd-kit |
| スタイリング | Tailwind CSS v4 |
| テーマ | next-themes（ダークモードデフォルト） |
| レイアウト | react-resizable-panels（しおりエディタ3カラム） |
| ユニットテスト | Vitest + Testing Library |
| E2Eテスト | Playwright |
| 処理方式 | 全処理クライアントサイド（`output: "export"` で静的配信） |

## ディレクトリ構成

```
src/
├── app/                     # ページ・レイアウト
├── components/
│   ├── bookmark-editor/     # しおりエディタ・自動生成ダイアログ
│   ├── file-uploader/       # ファイルアップロード・結合ファイルリスト
│   ├── page-selector/       # ページ選択（削除・抽出用）
│   ├── page-sorter/         # ページ並び替え（DnD）
│   ├── page-viewer/         # 高解像度PDFビューアー（テキスト選択対応）
│   ├── pdf-viewer/          # サムネイルグリッド
│   ├── thumbnail-strip/     # サムネイルストリップ（しおり用）
│   └── ui/                  # ダイアログ・Toast・テーマ切替・処理中オーバーレイ
├── hooks/                   # カスタムフック（use-pdf, use-page-viewer）
├── lib/
│   ├── pdf/                 # PDF操作ロジック（結合・並替・抽出・削除・回転・しおり・自動生成）
│   └── utils/               # ユーティリティ（ページ範囲パース・ダウンロード・ツリー変換）
└── types/                   # 型定義（PDF・見出しパターン）
```

## UI 特徴

- ダークモードデフォルト（ライトモードへの切り替え可）
- サムネイルの Ctrl+ホイール ズーム
- PDFビューアーのテキスト選択でしおりタイトル入力
- PDF読み込み中のブラウザ閉じ警告
- タブ切り替え時の確認ダイアログ
- モバイル対応（レスポンシブパディング・タブ横スクロール）

## 制限事項

- パスワード付きPDF: 対応済み（`ignoreEncryption: true`）
- 全処理がクライアントサイドのため、非常に大きなPDF（数百ページ）ではメモリ不足の可能性あり
- しおりの読み取りは Dest 配列形式のみ対応（Action 形式は未対応）

## ライセンス

Private
