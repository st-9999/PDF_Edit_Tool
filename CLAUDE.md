# PDF Edit Tool - プロジェクト仕様書

## プロジェクト概要

PDFファイルを編集するWebアプリケーション。ページの並び替え・削除・抽出・回転、複数PDFの結合、しおり（ブックマーク）の作成を主要機能とする。

## 技術スタック

- **フレームワーク**: Next.js (App Router)
- **言語**: TypeScript（フロント・バック統一）
- **PDF処理**: pdf-lib
- **UIライブラリ**: React + dnd-kit（ドラッグ&ドロップ）
- **スタイリング**: Tailwind CSS
- **パッケージマネージャ**: npm
- **Node.js**: v20 LTS 以上

## アーキテクチャ

```
src/
├── app/                    # Next.js App Router
│   ├── layout.tsx          # ルートレイアウト
│   ├── page.tsx            # メインページ
│   └── api/                # API Routes
│       └── pdf/
│           ├── merge/      # PDF結合エンドポイント
│           ├── reorder/    # ページ並び替えエンドポイント
│           ├── extract/    # ページ抽出エンドポイント
│           └── bookmark/   # しおり作成エンドポイント
├── components/             # UIコンポーネント
│   ├── pdf-viewer/         # PDFプレビュー・サムネイル表示
│   ├── page-sorter/        # ドラッグ&ドロップ並び替え
│   ├── page-selector/      # ページ選択（削除・抽出用）
│   ├── file-uploader/      # ファイルアップロード
│   └── bookmark-editor/    # しおりエディタ（ツリー構造）
├── lib/                    # ビジネスロジック
│   ├── pdf/                # PDF操作ユーティリティ
│   │   ├── merge.ts        # 結合処理
│   │   ├── reorder.ts      # 並び替え処理
│   │   ├── extract.ts      # 抽出処理
│   │   ├── delete.ts       # 削除処理
│   │   ├── rotate.ts       # 回転処理
│   │   └── bookmark.ts     # しおり処理
│   └── utils/              # 汎用ユーティリティ
├── types/                  # 型定義
│   └── pdf.ts
└── hooks/                  # カスタムフック
    └── use-pdf.ts
```

## 主要機能（v1 スコープ）

### 1. ページ並び替え
- PDFをアップロードするとサムネイル一覧を表示
- ドラッグ&ドロップでページ順序を変更
- 変更後のPDFをダウンロード

### 2. 複数PDFの結合
- 複数のPDFファイルをアップロード
- ファイル単位・ページ単位で順序を指定
- 結合したPDFをダウンロード

### 3. ページ削除
- サムネイル一覧から削除するページを選択（複数選択可）
- 選択ページを除外したPDFをダウンロード

### 4. ページ抽出
- サムネイル一覧から抽出するページを選択（複数選択可）
- 選択ページだけで構成された新規PDFをダウンロード
- 連続ページ範囲の指定にも対応（例: 3-7, 12, 15-20）

### 5. ページ回転
- サムネイル一覧から回転するページを選択（複数選択可）
- 回転角度を指定（90°/ 180°/ 270°、時計回り）
- 個別ページごと、または選択ページ一括で回転
- 回転後のPDFをダウンロード

### 6. しおり（ブックマーク）の作成
- 階層構造（ツリー）のしおりを作成
- しおり名とリンク先ページを指定
- 親子関係のネスト対応（章 > 節 > 項）
- 既存のしおりの編集・削除

## 将来機能（v2 以降）

- **しおり自動作成**: PDF本文から章・項・節の見出しを自動抽出し、階層しおりを生成
  - 対応パターン: 「第1章」「1.1」「1.1.1」等の番号付き見出し
  - pdfjs-dist でテキスト抽出 → 正規表現で見出し検出 → 階層構造を推定
  - 自動生成後に手動で編集・調整可能（v1 のしおりエディタと連携）
- **PDFレビュー（注釈・指摘）**: PDFページ上に矩形等の図形で範囲を指定し、指摘コメントを記録
  - 矩形描画による指摘箇所のマーキング（将来的に矢印・フリーハンド等も検討）
  - 各マーキングに対するコメント入力・編集・削除
  - 指摘一覧のリスト表示（ページ番号・コメント内容）
  - レビューデータのエクスポート（JSON / PDF注釈として埋め込み）

## 非機能要件

- **ファイルサイズ**: 数十MB（〜100ページ超）のPDFを扱える
- **処理方式**: ファイルはサーバーサイド（API Routes）で処理。一時ファイルは処理後に削除
- **認証**: 不要（個人利用）
- **ブラウザ**: Chrome最新版を主要ターゲット
- **レスポンシブ**: デスクトップファースト（モバイル対応は後回し）

## 開発・実行方法

```bash
# 依存関係インストール
npm install

# 開発サーバー起動
npm run dev

# ビルド
npm run build

# 本番起動
npm start
```

## デプロイ

- テスト段階: ローカルで `npm run dev` または `npm start` で起動
- 本番: 未定（Vercel等を検討）

## コーディング規約

- Conventional Commits でコミットメッセージを記述
- ESLint + Prettier による自動フォーマット
- コンポーネントは1ファイル1コンポーネント
- API Routesはエラーハンドリングを必ず実装
- PDF処理は `lib/pdf/` に集約し、コンポーネントから直接呼ばない

## 制約・注意事項

- pdf-lib はPDFの描画（レンダリング）機能を持たない → サムネイル表示には pdfjs-dist を別途使用
- 大容量ファイルのアップロードにはNext.jsのbodyParser設定の調整が必要
- 一時ファイルの保存先とクリーンアップ戦略を設計すること


# 基本方針
- 必ず日本語で応対してください
- 調査やデバッグにはサブエージェントを活用してコンテキストを節約してください
- 重要な決定事項は定期的にマークダウンファイルに記録してください
